pipeline {
    agent any

    environment {

        MAVEN_HOME = '/usr/share/maven'
        JAVA_HOME = '/usr/share/java'

        GITHUB_URL = 'https://github.com/miguelvdsc/M1A_1212147_1162086.git'
        GITHUB_BRANCH = 'main'
        GITHUB_ID = 'githubcredentials'
    }

    stages {
        stage('Checkout') {
            steps {
                git url: "${GITHUB_URL}", branch: "${GITHUB_BRANCH}", credentialsId: "${GITHUB_ID}"
            }
        }

        stage('Build') {
            steps {
                sh "${MAVEN_HOME}/bin/mvn clean install"
            }
        }
        stage('Validate') {
            steps {
                sh "${MAVEN_HOME}/bin/mvn validate"
            }
        }

        stage('Compile') {
            steps {
                sh "${MAVEN_HOME}/bin/mvn compile"
            }
        }

        stage('Test') {
            steps {
                sh "${MAVEN_HOME}/bin/mvn test"
            }
        }

        stage('Package') {
            steps {
                sh "${MAVEN_HOME}/bin/mvn package"
            }
        }

        stage('SonarQube Analysis') {
            steps {
                withSonarQubeEnv('sonarqubeServer') {
                    sh 'mvn sonar:sonar -Dsonar.projectKey=lms-sonar -Dsonar.projectName='lms-sonar' -Dsonar.host.url=http://localhost:9000' //port 9000 is default for sonar
                    echo 'SonarQube Analysis Completed'
                }
            }
        }



    }


    post {
        success {
            // Actions to take when the pipeline succeeds
            echo 'Pipeline completed successfully!'
        }
        failure {
            // Actions to take when the pipeline fails
            echo 'Pipeline failed!'
        }
    }
}